@model gestionaMelon.vista

@{
    ViewBag.Title = "Create";
}

<h4>Create</h4>


@using (Html.BeginForm()) 
{
    @Html.AntiForgeryToken()
    
    <div class="form-horizontal">
        <hr />
        @Html.ValidationSummary(true)

        <h4 class="col-md-2">Elegir alumno: </h4>
        <a href="javascript: void (0);" class="anchorDetail col-md-3">
            <input type="button" value="Buscar" class="btn btn-primary btn-block" />
        </a> <br />
        
        <hr />
        <div class="elegirAlumno" style="display:none"> 
            <div class="form-group">
                @Html.LabelFor(model => model.ndeserie, new { @class = "control-label col-md-2", id = "label_ndeserie" })
                <div class="col-md-10">
                    @Html.TextBoxFor(model => model.ndeserie, new { disabled = "true" })
                    @Html.ValidationMessageFor(model => model.ndeserie)
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.alumno, new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.TextBoxFor(model => model.alumno, new { disabled = "true" })
                    @Html.ValidationMessageFor(model => model.alumno)
                </div>
            </div>  

            <div class="form-group">
                @Html.LabelFor(model => model.alumno1.nombre, new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.TextBoxFor(model => model.alumno1.nombre, new { disabled = "true" })
                </div>
            </div>
            <div class="form-group">
                @Html.LabelFor(model => model.alumno1.apellido, new { @class = "control-label col-md-2" })
                <div class="col-md-10">
                    @Html.TextBoxFor(model => model.alumno1.apellido, new { disabled = "true" })
                </div>
            </div>

            <div class="form-group">
                @Html.LabelFor(model => model.fk_id_alumno, "fk_id_alumno", new { @class = "control-label col-md-2", id = "id_idalumno" })
                <div class="col-md-10">
                    @*@Html.DropDownList("fk_id_alumno", null, new{@class="ddlistSearch"})*@
                    @Html.EditorFor(model => model.fk_id_alumno, new { disabled = "true" })
                    @Html.ValidationMessageFor(model => model.fk_estado)

                </div>
            </div>
        </div>
        <div class="infoAlumno" style="display:none">
            <label class="control-label col-md-5" id="label_info"></label>
        </div>
      <br />
        <hr />
        <div class="infoNetbook" style="display:none">
            <div class="alert-info">Deberá asignarle una netbook</div> <br>
            <div class="form-group "><label  class="control-label col-md-2">Netbook</label><input type="text" class="form-control" name="ndeserie_nuevo" id="ndeserie_nuevo" /></div>
            <div class="form-group "><label class="control-label col-md-2">Marca</label><input type="text" class="form-control" name="marca_nuevo" id="marca_nuevo" /></div>
            <div class="form-group"><label class="control-label col-md-2">Modelo</label><input type="text" class="form-control" name="modelo_nuevo" id="modelo_nuevo" /></div>
        </div>
        
        <hr /><br />

        <div class="form-group">
           @Html.LabelFor(model => model.fk_estado, "fk_estado", new { @class = "control-label col-md-2" })
            <div class="col-md-10">
               @* @Html.DropDownList("fk_estado",null, new{@class="ddlistSearch"})*@
                @Html.DropDownList("fk_estado", null, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.fk_estado)
            </div>
        </div>

        

        <div class="form-group">
            @Html.LabelFor(model => model.fechaIngreso, new { @class = "control-label col-md-2" })
            <div class="col-xs-10">
                @Html.TextBoxFor(model => model.fechaIngreso, "{0:yyyy-MM-dd}", new { type = "date" , @class="form-control" })
                @Html.ValidationMessageFor(model => model.fechaIngreso)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.flagRetirada ,new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.EditorFor(model => model.flagRetirada, new { htmlAttributes = new { @class = "form-control" } })
            
                @Html.ValidationMessageFor(model => model.flagRetirada)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.fechaRetirada, new { @class = "control-label col-md-2" })
            <div class="col-xs-10">
                @Html.TextBoxFor(model => model.fechaRetirada, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })
                @Html.ValidationMessageFor(model => model.fechaRetirada)
            </div>
        </div>

        <div class="form-group">
            @Html.LabelFor(model => model.comentarios, new { @class = "control-label col-md-2" })
            <div class="col-md-10">
                @Html.TextAreaFor(model => model.comentarios, new { @class = "form-control" })
                @Html.ValidationMessageFor(model => model.comentarios)
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input type="submit" value="Create" class="btn btn-default" />
            </div>
        </div>
    </div>
}

<div>
    @Html.ActionLink("Back to List", "Index")
</div>


<div id='myModal' class='modal'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myModalLabel">Busqueda</h4>
            </div>
            <div id='myModalContent'>
                    <div>
                        <input type="text" id="busquedaAlumno" class="col-md-offset-3 col-md-6 form-control" />
                        <input type="button" id="btnSubmit" class="btn btn-primary btn-block col-md-offset-3 col-md-6" value="Buscar Alumno" onclick="javascript:cargar ();" />
                        <br /> <br />
                        <div id="Result"></div>
                        <hr />
                    </div>
             </div>


            </div>
    </div>

</div>   

@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
<script src="~/Scripts/jquery-1.10.2.min.js"></script>
<script src="~/Scripts/bootstrap.js"></script>
<script src="~/Scripts/bootstrap.min.js"></script>

        <script>

            $(function () {
                $(".anchorDetail").click(function () { // carga el modal con textbox buscar y boton buscar
                    debugger;

                    var $buttonClicked = $(this);
                    var id = $buttonClicked.attr('data-id');
                    var TeamDetailPostBackURL = $buttonClicked.attr('data-url');
                    var options = { "backdrop": "static", keyboard: true };
                    $.ajax({
                        type: "GET",
                        url: TeamDetailPostBackURL,
                        contentType: "application/json; charset=utf-8",
                        data: { "Id": id },
                        datatype: "json",
                        success: function (data) {
                            debugger;
                            //$('#myModalContent').html(data);
                            $('#myModal').modal(options);
                            $('#myModal').modal('show');

                        },
                        error: function () {
                            alert("Dynamic content load failed.");
                        }
                    });
                });
                //$("#closebtn").on('click',function(){
                //    $('#myModal').modal('hide');

                $("#closbtn").click(function () {
                    $('#myModal').modal('hide');
                });
            });
            function cargar() { // agrega al modal el partialView Alumno/Buscar con el parametro del textbox de busqueda
                $(function () {
                    var URL = "/Alumno/Buscar?busqueda=" + $("#busquedaAlumno").val();
                    $.get(URL, function (data) {
                        var htmlData = $("#Result");
                        htmlData.html(data);
                    })
                });
            }

            function cargar2() {
                $(function () {
                    var URL = "/Netbook/PartialCreate";
                    $.get(URL, function (data) {
                        var htmlData = $("#Result");
                        htmlData.html(data);
                    })
                });
            }

            function cambiar(ndeserie, alumno, id_alumno, nombre, apellido) {
                $(function () {
                    //$(".elegirAlumno").show();
                    $(".infoAlumno").show();
                    document.getElementById("ndeserie").value = ndeserie;
                    document.getElementById("alumno").value = alumno;
                    document.getElementById("fk_id_alumno").value = id_alumno;
                    document.getElementById("alumno1_nombre").value = nombre;
                    document.getElementById("alumno1_apellido").value = apellido;

                    //$("#label_info").show();
                    $("#label_info").text(nombre + " " + apellido + " (Dni:" + alumno + " - ndeserie:" + ndeserie + ")");
                    //$("#fk_id_alumno").hide();
                    // $("#id_idalumno").hide();
                    if (ndeserie == "sin asignar") {
                        //cargar2();
                        $(".infoNetbook").show();
                    } else {
                        $(".infoNetbook").hide();
                    }

                    $('#myModal').modal('hide')
                });
            }

            $(function () {
                $(".ddlistSearch").chosen();
                $("#flagRetirada").val("false"); //marca el ddlist de retirada como no retirada (revisar que no acepte null el atributo)

                
                
            });

        
         
    </script>
}
