@model gestionaMelon.vista

@{
    ViewBag.Title = "Edit";
}

<h2>Edit</h2>


<div class="container">

    @using (Html.BeginForm())
    {
        @Html.AntiForgeryToken()

        <div class="form-horizontal">
            @*<h4>vista</h4>*@
            @Html.ValidationSummary(true)
            @Html.HiddenFor(model => model.idVista)

            <h4 class="col-md-2">Elegir alumno: </h4>
            <a href="javascript: void (0);" class="anchorDetail col-md-3">
                <input type="button" value="Buscar" class="btn btn-primary btn-block" />
            </a> <br />

            <hr />


            <div class="elegirAlumno" style="display:none">
                <div class="form-group">
                    @Html.LabelFor(model => model.alumno1.netbook.ndeserie, new { @class = "control-label col-md-2" })
                    <div class="col-md-10">
                        @Html.TextBoxFor(model => model.alumno1.netbook.ndeserie, new { disabled = "true" , id="ndeserie"})
                        @Html.ValidationMessageFor(model => model.alumno1.netbook.ndeserie)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.alumno1.dni, new { @class = "control-label col-xs-2" })
                    <div class="col-md-10">
                        @Html.TextBoxFor(model => model.alumno1.dni, new { disabled = "true", id = "alumno" })
                        @Html.ValidationMessageFor(model => model.alumno1.dni)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.alumno1.nombre, new { @class = "control-label col-xs-2" })
                    <div class="col-md-10">
                        @Html.TextBoxFor(model => model.alumno1.nombre, new { disabled = "true", id = "alumno1_nombre" })
                    </div>
                </div>
                <div class="form-group">
                    @Html.LabelFor(model => model.alumno1.apellido, new { @class = "control-label col-xs-2" })
                    <div class="col-md-10">
                        @Html.TextBoxFor(model => model.alumno1.apellido, new { disabled = "true", id = "alumno1_apellido" })
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.fk_id_alumno, "fk_id_alumno", new { @class = "control-label col-xs-2", id = "id_idalumno" })
                    <div class="col-md-10">
                        @*@Html.DropDownList("fk_id_alumno", null, new{@class="ddlistSearch"})*@
                        @Html.EditorFor(model => model.fk_id_alumno, new { disabled = "true", id= " fk_id_alumno" })
                        @Html.ValidationMessageFor(model => model.fk_estado)
                    </div>
                </div>
                </div>

                <div class="infoAlumno" style="display:none">
                    <label class="control-label col-md-5" id="label_info">a</label>
                </div>
                <hr />
                <br />
            <div class="infoNetbook" style="display:none">
                <div class="alert-info">Deberá asignarle una netbook</div> <br>
                <div class="form-group "><label class="control-label col-md-2">Netbook</label><input type="text" class="form-control" name="ndeserie_nuevo" id="ndeserie_nuevo" /></div>
                <div class="form-group "><label class="control-label col-md-2">Marca</label><input type="text" class="form-control" name="marca_nuevo" id="marca_nuevo" /></div>
                <div class="form-group"><label class="control-label col-md-2">Modelo</label><input type="text" class="form-control" name="modelo_nuevo" id="modelo_nuevo" /></div>
            </div>
            <hr />
                <div class="form-group">
                    @Html.LabelFor(model => model.fk_estado, "fk_estado", new { @class = "control-label col-xs-2" })
                    <div class="col-xs-10">
                        @Html.DropDownList("fk_estado", null, new { @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.fk_estado)
                    </div>
                </div>


                <div class="form-group">
                    @Html.LabelFor(model => model.fechaIngreso, new { @class = "control-label col-xs-2" })
                    <div class="col-xs-10">
                        @Html.TextBoxFor(model => model.fechaIngreso, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.fechaIngreso)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.flagRetirada, new { @class = "control-label col-xs-2" })
                    <div class="col-xs-10">
                        @Html.EditorFor(model => model.flagRetirada)
                        @Html.ValidationMessageFor(model => model.flagRetirada)
                    </div>
                </div>

                <div class="form-group">
                    @Html.LabelFor(model => model.fechaRetirada, new { @class = "control-label col-xs-2" })
                    <div class="col-xs-10">
                        @Html.TextBoxFor(model => model.fechaRetirada, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })
                        @Html.ValidationMessageFor(model => model.fechaRetirada)
                    </div>
                </div>

            <div class="form-group">
                @Html.LabelFor(model => model.comentarios, new { @class = "control-label col-xs-2" })
                <div class="col-xs-10">
                    @Html.TextAreaFor(model => model.comentarios, new { @class = "form-control" })
                    @Html.ValidationMessageFor(model => model.comentarios)
                </div>
            </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-xs-10">
                        <input type="submit" value="Save" class="btn btn-default" />
                    </div>
                </div>
            </div>
    }

    <div>
        @*@Html.ActionLink("Back to List", "Index")*@
        @Html.ActionLink("Back to previous page", null, null, null, new { href = Request.UrlReferrer })

    </div>

</div>


<div id='myModal' class='modal'>
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                <h4 class="modal-title" id="myModalLabel">Busqueda</h4>
            </div>
            <div id='myModalContent'>
                <div>
                    <input type="text" id="busquedaAlumno" class="col-md-offset-3 col-md-6" />
                    <input type="button" id="btnSubmit" class="btn btn-primary btn-block col-md-offset-3 col-md-6" value="Buscar Alumno" onclick="javascript:cargar();" />
                    <br /> <br />
                    <div id="Result"></div>
                    <hr />
                </div>
            </div>


        </div>
    </div>

</div>




        @section Scripts {
            @Scripts.Render("~/bundles/jqueryval")
            <script src="~/Scripts/jquery-1.10.2.min.js"></script>
            <script src="~/Scripts/bootstrap.js"></script>
            <script src="~/Scripts/bootstrap.min.js"></script>

            <script>

                $(function () {
                    //$(".ddlistSearch").chosen();
                    var ndeserie = $("#ndeserie").val();
                    var nombre = $("#alumno1_nombre").val();
                    var apellido = $("#alumno1_apellido").val();
                    var alumno = $("#alumno").val();
                    var id_alumno = $("#fk_id_alumno").val();
                  
                    $(".infoAlumno").show();
                    //$("#label_info").text(ndeserie);
                  
                    $("#label_info").text(nombre + " " + apellido + " (Dni:" + alumno + " - ndeserie:" + ndeserie + ")");
                    
                });

            $(function () {
            $(".anchorDetail").click(function () {
                debugger;

                var $buttonClicked = $(this);
                var id = $buttonClicked.attr('data-id');
                var TeamDetailPostBackURL = $buttonClicked.attr('data-url');
                var options = { "backdrop": "static", keyboard: true };
                $.ajax({
                    type: "GET",
                    url: TeamDetailPostBackURL,
                    contentType: "application/json; charset=utf-8",
                    data: { "Id": id },
                    datatype: "json",
                    success: function (data) {
                        debugger;
                        //$('#myModalContent').html(data);
                        $('#myModal').modal(options);
                        $('#myModal').modal('show');

                    },
                    error: function () {
                        alert("Dynamic content load failed.");
                    }
                });
            });
            //$("#closebtn").on('click',function(){
            //    $('#myModal').modal('hide');

            $("#closbtn").click(function () {
                $('#myModal').modal('hide');
            });
        });
        function cargar() {
            $(function () {
                var URL = "/Alumno/Buscar?busqueda=" + $("#busquedaAlumno").val();
                    $.get(URL, function (data) {
                        var htmlData = $("#Result");
                        htmlData.html(data);
                })
            });
        }

        function cambiar(ndeserie, alumno, id_alumno, nombre, apellido) {
            $(function () {
                $(".infoAlumno").show();
               

                $("#ndeserie").val(ndeserie);
                $("#alumno").val(alumno);
                $("#alumno1_nombre").val(nombre);
                $("#alumno1_apellido").val(apellido);
                $("#fk_id_alumno").val(id_alumno);
//                document.getElementById("fk_id_alumno").value = id_alumno;

                //$("#label_info").show();
                $("#label_info").text(nombre + " " + apellido + " (Dni:" + alumno + " - ndeserie:" + ndeserie + ")");
                if (ndeserie == "sin asignar") {
                    //cargar2();
                    $(".infoNetbook").show();
                } else {
                    $(".infoNetbook").hide();
                }

                $("#fk_id_alumno").hide();
                $("#id_idalumno").hide();
                $('#myModal').modal('hide');
            });
        }
 </script>

}